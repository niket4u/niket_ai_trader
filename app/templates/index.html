
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>NiketBot Dashboard</title>

  <!-- PWA: manifest + theme -->
  <link rel="manifest" href="/static/manifest.webmanifest">
  <meta name="theme-color" content="#0b0f14">

  <!-- iOS PWA (Add to Home Screen) -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="NiketBot">
  <link rel="apple-touch-icon" href="/static/icons/icon-192.png">

  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin:0; padding:0; background:#0b0f14; color:#e6edf3; }
    header { padding:16px; background:#0e1720; position:sticky; top:0; }
    .container { padding: 16px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 12px; }
    .card { background:#121a24; border:1px solid #1c2733; border-radius:12px; padding:16px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
    pre { white-space: pre-wrap; word-wrap: break-word; }
    .muted { color:#94a3b8; }
    .val { font-weight: 600; }
  </style>

  <meta http-equiv="refresh" content="{{ refresh }}">
</head>
<body>
<header>
  <h2>NiketBot â€” Phase 2 Dashboard</h2>
  <div class="muted">Auto-refresh: {{ refresh }}s</div>
</header>
<div class="container">
  <div class="grid">
    <div class="card">
      <div>Mode</div>
      <div class="val">{{ (state.mode if state else 'paper')|upper }}</div>
      <div class="muted">Last run (UTC): {{ state.last_run_utc if state else '' }}</div>
    </div>
    <div class="card">
      <div>Cash Spent</div>
      <div class="val">{{ '%.2f' % (state.caps.cash_spent if state and state.caps else 0) }}</div>
    </div>
    <div class="card">
      <div>PnL Day</div>
      <div class="val">{{ '%.2f' % (state.caps.pnl_day if state and state.caps else 0) }}</div>
    </div>
    <div class="card">
      <div>PnL Month</div>
      <div class="val">{{ '%.2f' % (state.caps.pnl_month if state and state.caps else 0) }}</div>
    </div>
  </div>

  <div class="card" style="margin-top:12px;">
    <h3>Positions</h3>
    <pre>{% if state and state.positions %}{{ state.positions | tojson(indent=2) }}{% else %}<em>No positions yet.</em>{% endif %}</pre>
  </div>

  <div class="card" style="margin-top:12px;">
    <h3>Recent Log Tail</h3>
    <pre>{% for ln in lines %}{{ ln }}{% endfor %}</pre>
  </div>
</div>

<script>
  // Register service worker (PWA) if supported
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("/static/service-worker.js").catch(err => {
        console.log("SW registration failed:", err);
      });
    });
  }
</script>

</body>
</html>
